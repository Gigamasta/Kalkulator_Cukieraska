<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Kalkulator Bolusa - Aleksander</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body, input, textarea, select { -webkit-user-scalable: no; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        input[type="text"], input[type="number"], textarea, select { -webkit-user-select: text; user-select: text; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .header h1 { font-size: 20px; margin-bottom: 4px; }
        .header p { font-size: 12px; opacity: 0.9; }
        .tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 70px;
        }
        .tab-btn:hover { background: #f8f9fb; }
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f0f2ff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 12px; }
        .content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 16px;
            margin-bottom: 16px;
            min-height: 60vh;
        }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        h2 { color: #667eea; margin-bottom: 12px; font-size: 18px; }
        h3 { color: #667eea; font-size: 13px; margin-bottom: 10px; }
        
        /* FORM STYLES */
        .section-box { background: #f8f9fb; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .form-group { margin-bottom: 10px; }
        .form-label { display: block; font-size: 11px; font-weight: 600; color: #666; margin-bottom: 4px; }
        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
            margin-top: 6px;
        }
        button:hover { opacity: 0.9; }
        button:active { transform: scale(0.98); }
        
        .product-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
        }
        .product-info { flex: 1; }
        .product-carbs { color: #667eea; font-weight: 700; margin: 0 8px; }
        .remove-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            width: auto;
            margin-top: 0;
        }
        
        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            display: none;
        }
        .result-box h3 { font-size: 12px; margin-bottom: 8px; color: white; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; }
        
        /* GUIDE STYLES */
        .guide-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .guide-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 12px;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .guide-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .guide-section.expanded .guide-content { max-height: 5000px; }
        .guide-section.expanded .guide-arrow { transform: rotate(180deg); }
        .guide-body { padding: 12px; font-size: 12px; line-height: 1.6; }
        .decision-box { background: #f0f4ff; border-left: 4px solid #667eea; padding: 8px; margin: 8px 0; border-radius: 4px; }
        .warning-box { background: #fff8e1; border-left: 4px solid #ffc107; padding: 8px; margin: 8px 0; border-radius: 4px; }
        .danger-box { background: #ffebee; border-left: 4px solid #dc3545; padding: 8px; margin: 8px 0; border-radius: 4px; font-weight: 600; color: #c41c3b; }
        .contact-box { background: #e3f2fd; border: 1px solid #667eea; border-radius: 6px; padding: 8px; margin: 8px 0; }
        .contact-box strong { display: block; margin-bottom: 4px; color: #667eea; font-weight: 700; }
        .contact-box a { color: #dc3545; font-weight: 700; text-decoration: none; font-size: 16px; }
        ul { margin-left: 16px; font-size: 11px; }
        li { margin: 4px 0; }
        strong { color: #667eea; font-weight: 700; }
        
        @media (max-width: 600px) {
            .header h1 { font-size: 16px; }
            .tab-btn { font-size: 10px; padding: 10px 4px; }
            .container { padding: 8px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíâ Kalkulator Bolusa - Aleksander</h1>
        <p>Cukrzyca Typ 1 | Urodzony: 11.03.2025</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-tab="calculator">Kalkulator</button>
        <button class="tab-btn" data-tab="products">Produkty</button>
        <button class="tab-btn" data-tab="scanner">Skaner</button>
        <button class="tab-btn" data-tab="guide">üìñ Poradnik</button>
    </div>

    <div class="container">
        <div class="content">
            <!-- CALCULATOR TAB -->
            <div class="tab-pane active" id="calculator">
                <h2>‚öôÔ∏è Kalkulator Bolusa</h2>
                <div class="section-box">
                    <h3>Parametry Insuliny</h3>
                    <div class="form-group">
                        <label class="form-label">Glikemia docelowa (mg/dl)</label>
                        <input type="number" id="target-glucose" value="100" step="5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ICR - Wska≈∫nik wƒôglowodan√≥w (g/j.i.)</label>
                        <input type="number" id="icr" value="12" step="0.5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ISF - Wra≈ºliwo≈õƒá na insulinƒô (mg/dl/j.i.)</label>
                        <input type="number" id="isf" value="50" step="5">
                    </div>
                </div>
                <div class="section-box">
                    <h3>Pomiar Glikemii</h3>
                    <div class="form-group">
                        <label class="form-label">Obecna glikemia (mg/dl)</label>
                        <input type="number" id="glucose-level" placeholder="Zmierz teraz" step="1">
                    </div>
                </div>
                <div class="section-box">
                    <h3>Wƒôglowodany</h3>
                    <div class="form-group">
                        <label class="form-label">Wƒôglowodany z produkt√≥w (automatycznie)</label>
                        <input type="text" id="products-carbs" value="0 g" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dodatkowe wƒôglowodany rƒôcznie (g)</label>
                        <input type="number" id="manual-carbs" value="0" step="0.5">
                    </div>
                    <button id="add-product-btn">+ Dodaj produkt z bazy</button>
                </div>
                <div id="selected-products" style="font-size: 11px;"><div style="text-align: center; color: #999; padding: 12px;">Brak wybranych produkt√≥w</div></div>
                <button id="calculate-bolus" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: 12px;">üßÆ Oblicz Bolus</button>
                <div id="bolus-result" class="result-box">
                    <h3>Wynik Obliczenia</h3>
                    <div class="result-row">
                        <span>Bolus posi≈Çkowy:</span>
                        <span id="meal-bolus">0</span>
                    </div>
                    <div class="result-row">
                        <span>Bolus korygujƒÖcy:</span>
                        <span id="correction-bolus">0</span>
                    </div>
                    <div class="result-row" style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 6px; font-weight: 700;">
                        <span>Razem:</span>
                        <span id="total-bolus">0</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px; opacity: 0.9;">Wƒôglowodany: <span id="total-carbs">0</span>g</div>
                    <button id="confirm-bolus" style="background: #28a745; margin-top: 8px;">‚úì Zapisz do historii</button>
                    <button id="cancel-bolus" style="background: #6c757d; margin-top: 6px;">‚úï Anuluj</button>
                </div>
                <div style="margin-top: 16px;">
                    <h3>Historia Bolus√≥w</h3>
                    <div id="bolus-history" style="font-size: 11px;"><div style="text-align: center; color: #999; padding: 12px;">Brak historii</div></div>
                </div>
            </div>

            <!-- PRODUCTS TAB -->
            <div class="tab-pane" id="products">
                <h2>üì¶ Baza Produkt√≥w</h2>
                <div class="section-box">
                    <h3>Wyszukiwanie i Filtrowanie</h3>
                    <div class="form-group">
                        <input type="text" id="search-products" placeholder="Szukaj produktu...">
                    </div>
                    <div class="form-group">
                        <select id="filter-category">
                            <option value="">Wszystkie kategorie</option>
                        </select>
                    </div>
                    <button onclick="addNewProduct()">+ Dodaj nowy produkt</button>
                </div>
                <div id="products-list" style="font-size: 11px;"><div style="text-align: center; color: #999; padding: 12px;">≈Åadowanie produkt√≥w...</div></div>
            </div>

            <!-- SCANNER TAB -->
            <div class="tab-pane" id="scanner">
                <h2>üì∑ Skaner Kod√≥w</h2>
                <div style="text-align: center; padding: 32px; color: #999;">
                    <p>Funkcja skanera wymaga dostƒôpu do kamery.</p>
                    <p style="font-size: 11px; margin-top: 8px;">Mo≈ºesz rƒôcznie dodaƒá produkty w sekcji Produkty.</p>
                </div>
            </div>

            <!-- GUIDE TAB - PORADNIK -->
            <div class="tab-pane" id="guide">
                <h2>üìñ Poradnik Cukrzycy Typu 1 - Aleksander</h2>

                <!-- 1. KONTAKT Z ZESPO≈ÅEM MEDYCZNYM -->
                <div class="guide-section expanded">
                    <div class="guide-header">
                        <span>üìû Kontakt Z Zespo≈Çem Medycznym</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="contact-box">
                                <strong>üö® POGOTOWIE RATUNKOWE</strong>
                                <a href="tel:999">999</a> lub <a href="tel:112">112</a>
                                <small style="display: block; margin-top: 8px;"><strong>Dzwo≈Ñ NATYCHMIAST je≈õli:</strong></small>
                                <ul style="margin-top: 4px;">
                                    <li>Aleksander jest nieprzytomny lub ma zaburzenia ≈õwiadomo≈õci</li>
                                    <li>Drgawki lub konwulsje</li>
                                    <li>Ciƒô≈ºki, przy≈õpieszony oddech (Kussmaula)</li>
                                    <li>Zapach acetonu z ust</li>
                                    <li>Nasilone wymioty trwajƒÖce ponad 2 godziny</li>
                                    <li>B√≥l brzucha z wysokƒÖ glukozƒÖ >250 mg/dl</li>
                                    <li>Tachykardia (szybkie bicie serca) >150 bpm</li>
                                </ul>
                            </div>
                            <div class="contact-box">
                                <strong>üë®‚Äç‚öïÔ∏è Pediatra Diabetolog</strong>
                                <small>Nr: ___________________________</small>
                            </div>
                            <div class="contact-box">
                                <strong>üè• Poradnia Diabetologiczna</strong>
                                <small>Nr: ___________________________</small>
                            </div>
                            <div class="contact-box">
                                <strong>üîß Serwis Pompy Insulinowej</strong>
                                <small>Nr: ___________________________</small>
                            </div>
                            <div class="warning-box">‚ö†Ô∏è <strong>ZAPISZ WSZYSTKIE NUMERY!</strong> Miej je dostƒôpne nawet bez internetu!</div>
                        </div>
                    </div>
                </div>

                <!-- 2. SZYBKA ≈öCIƒÑGA -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>‚ö° Szybka ≈öciƒÖga</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <strong>Poziomy Glukozy (mg/dl):</strong>
                            <ul>
                                <li><strong>&lt;55:</strong> üî¥ CIƒò≈ªKA HIPOGLIKEMIA - WEZWIJ <a href="tel:999" style="color: #dc3545;">999</a>!</li>
                                <li><strong>55-70:</strong> üü† Umiarkowana hipoglikemia - Szybkie WW</li>
                                <li><strong>70-100:</strong> üü¢ Norma (prawid≈Çowy zakres)</li>
                                <li><strong>100-150:</strong> üü¢ Norma (ponad docelowa)</li>
                                <li><strong>150-200:</strong> üü° WznoszƒÖca siƒô hiperglikemia</li>
                                <li><strong>200-250:</strong> üü° Wyra≈∫na hiperglikemia</li>
                                <li><strong>&gt;250:</strong> üî¥ Powa≈ºna hiperglikemia - Mierz ketony!</li>
                                <li><strong>&gt;350 z ketonami:</strong> üî¥ PODEJRZENIE DKA - WEZWIJ <a href="tel:999" style="color: #dc3545;">999</a>!</li>
                            </ul>
                            <strong style="display: block; margin-top: 8px;">Przy Hipoglikemii (&lt;70 mg/dl):</strong>
                            <ul>
                                <li>Podaj 4-5g szybkich wƒôglowodan√≥w (sok, cukier)</li>
                                <li>Czekaj 15 minut</li>
                                <li>Zmierz ponownie</li>
                                <li>Powtarzaj je≈õli &lt;70 mg/dl</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 3. NISKA GLUKOZA - POMPA -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>üî¥ Niska Glukoza (Pompa) - &lt;70 mg/dl</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="decision-box">
                                <strong>‚ÑπÔ∏è Je≈õli Aleksander ma &lt;70 mg/dl:</strong>
                                <ul>
                                    <li>1Ô∏è‚É£ Zmierz PONOWNIE (mogƒÖ byƒá b≈Çƒôdy pomiaru)</li>
                                    <li>2Ô∏è‚É£ Podaj 4-5g szybkich WW: sok, mi√≥d, cukier, tabletka glukozy</li>
                                    <li>3Ô∏è‚É£ Czekaj 15 minut na wch≈Çoniƒôcie</li>
                                    <li>4Ô∏è‚É£ Zmierz ponownie: Je≈õli >100 OK | Je≈õli 70-100 obserwuj | Je≈õli <70 powt√≥rz | Je≈õli nadal pada wezwij <a href="tel:999" style="color: #dc3545;">999</a></li>
                                </ul>
                            </div>
                            <div class="danger-box">üö® <strong>JE≈öLI ALEKSANDER JEST NIEPRZYTOMNY:</strong> WEZWIJ <a href="tel:999" style="color: #fff;">999</a>! Nie podawaj nic przez usta. Podaj glukagon. Pozycja boczna. Sprawdzaj oddech!</div>
                            <div class="warning-box">‚ö†Ô∏è <strong>NIGDY nie suspenduj pompy!</strong> Mo≈ºe to prowadziƒá do DKA w ciƒÖgu godzin!</div>
                        </div>
                    </div>
                </div>

                <!-- 4. WYSOKA GLUKOZA - POMPA -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>üü° Wysoka Glukoza (Pompa) - >150 mg/dl</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="decision-box">
                                <strong>‚ÑπÔ∏è Glukoza 150-250 mg/dl (bez keton√≥w):</strong>
                                <ul>
                                    <li>1Ô∏è‚É£ Zmierz ketony (paski ketonowe)</li>
                                    <li>2Ô∏è‚É£ Nie ma keton√≥w: Podaj insulinƒô (z pompy) + woda + czekaj 2-3h + zmierz ponownie</li>
                                    <li>3Ô∏è‚É£ SƒÖ ≈õlady keton√≥w (<0.5 mmol/L): Zwiƒôksz insulinƒô o 10% + pena (nie pompa!) + woda + zmierz za 2h</li>
                                </ul>
                            </div>
                            <div class="danger-box">üö® <strong>Glukoza >250 mg/dl LUB ketony >0.5 mmol/L:</strong> PODEJRZENIE DKA! WEZWIJ <a href="tel:999" style="color: #fff;">999</a>! Wymioty, b√≥l brzucha, oddech przyspieszony, zapach acetonu!</div>
                            <div class="warning-box">‚ö†Ô∏è DKA mo≈ºe rozwinƒÖƒá siƒô w ciƒÖgu 4-12 godzin!</div>
                        </div>
                    </div>
                </div>

                <!-- 5. INFEKCJA/CHOROBA -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>ü§í Infekcja / Choroba</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="danger-box">üö® <strong>ZAWSZE PODAWAJ INSULINƒò!</strong> NIGDY nie przerywaj insuliny, nawet je≈õli nie je! Organizm potrzebuje insuliny do walki z infekcjƒÖ! Brak insuliny = DKA w godzinach!</div>
                            <div class="decision-box">
                                <strong>Je≈õli ma gorƒÖczkƒô, kaszel, biegunkƒô:</strong>
                                <ul>
                                    <li>1Ô∏è‚É£ Mierz glukozƒô co 2-4h (zamiast 3-4x dziennie)</li>
                                    <li>2Ô∏è‚É£ Glukoza zwykle RO≈öNIE - zwiƒôksz insulinƒô o 10-50%</li>
                                    <li>3Ô∏è‚É£ Dbaj o nawodnienie - du≈ºo wody</li>
                                    <li>4Ô∏è‚É£ Monitoruj ketony BARDZO UWA≈ªNIE!</li>
                                </ul>
                            </div>
                            <div class="warning-box">‚ö†Ô∏è DKA BARDZO CZƒòSTO pojawia siƒô przy infekcji!</div>
                        </div>
                    </div>
                </div>

                <!-- 6. AWARIA POMPY -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>üîß Awaria Pompy</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="danger-box">üö® <strong>POMPA CA≈ÅKOWICIE ZEPSUTA = PRZEJD≈π NA PENY!</strong> Zwiƒôksz insulinƒô o 20-30%! Mierz glukozƒô co 2-3h! Monitoruj ketony! Skontaktuj siƒô z diabetologiem!</div>
                            <div class="warning-box">‚ö†Ô∏è <strong>ZAWSZE miej w lod√≥wce zapasowƒÖ fiolkƒô insuliny bazowej!</strong></div>
                        </div>
                    </div>
                </div>

                <!-- 7. ≈öWIƒòTA I WYJAZDY -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>üéÑ ≈öwiƒôta i Wyjazdy</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="warning-box">‚ö†Ô∏è ≈öwiƒôta to NORMALNY CZAS! Baw siƒô razem z Aleksandrem!</div>
                            <div class="decision-box">
                                <strong>Pakowanie (PODW√ìJNE ilo≈õci!):</strong>
                                <ul>
                                    <li>Insulina (x2) + lod√≥wka przeno≈õna</li>
                                    <li>Glukometr + paski (x2)</li>
                                    <li>Ketony x2</li>
                                    <li>Glukagon + instrukcja</li>
                                    <li>Szybkie WW (3x ilo≈õƒá)</li>
                                    <li>Przepisy od lekarza</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 8. SZKO≈ÅA -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>üéí Szko≈Ça i Wakacje</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <div class="warning-box">‚ö†Ô∏è Aleksander MO≈ªE byƒá normalnym dzieckiem w szkole! Cukrzyca to nie niepe≈Çnosprawno≈õƒá!</div>
                            <div class="decision-box">
                                <strong>Wyposa≈ºenie w szkole:</strong>
                                <ul>
                                    <li>Szybkie WW (sok, cukier)</li>
                                    <li>Glukometr + paski</li>
                                    <li>Glukagon (jedna fiolka)</li>
                                    <li>Przepisy lekarskie</li>
                                    <li>Numer do rodzic√≥w</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. DOBRE PRAKTYKI -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>‚úÖ Dobre Praktyki</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <ul>
                                <li><strong>1. ZAWSZE insulina</strong> - nawet je≈õli nie je (choroba)</li>
                                <li><strong>2. Mierz glukozƒô regularnie</strong> - przed posi≈Çkami, 2h po, przed snem</li>
                                <li><strong>3. Obserwuj zmiany</strong> - zapotrzebowanie ro≈õnie co miesiƒÖc</li>
                                <li><strong>4. Dieta = obliczanie WW</strong> - brak zakaz√≥w!</li>
                                <li><strong>5. Edukacja rodziny</strong> - babcia, dziadek, opiekunowie MUSZƒÑ wiedzieƒá</li>
                                <li><strong>6. Psychika Aleksandra</strong> - cukrzyca to NIE kara!</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 10. O PORADNIKU -->
                <div class="guide-section">
                    <div class="guide-header">
                        <span>‚ÑπÔ∏è O Poradniku</span>
                        <span class="guide-arrow">‚ñº</span>
                    </div>
                    <div class="guide-content">
                        <div class="guide-body">
                            <p><strong>Wersja: 3.0 - Pe≈Çny plik z poradnikiem i linkami tel:</strong></p>
                            <p style="margin-top: 8px; font-size: 11px;">‚ö†Ô∏è Poradnik wspomaga decyzje, ale NIGDY nie zastƒôpuje porad lekarza. ZAWSZE konsultuj z diabetologiem Aleksandra.</p>
                            <p style="margin-top: 8px; font-size: 11px;">üí™‚ù§Ô∏è ≈ªyczƒô si≈Çy i wielu szczƒô≈õliwych dni razem!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // COMPLETE EMBEDDED CODE
        let db = null;
        const DB_NAME = 'AlexanderDiabetesDB';
        const DB_VERSION = 1;

        const AppState = {
            products: [],
            categories: ['Piekarnicze', 'Owoce', 'Warzywa', 'Mleko', 'Miƒôso', 'S≈Çodyczne', 'Napoje', 'Inne'],
            selectedProducts: [],
            bolusHistory: [],
            parameters: { targetGlucose: 100, icr: 12, isf: 50 }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            await initializeDatabase();
            await loadDataFromDB();
            initializeTabs();
            initializeCalculator();
            initializeProducts();
            initializeGuide();
            if (AppState.products.length === 0) {
                loadSampleData();
                await saveAllData();
            }
        });

        function initializeDatabase() {
            return new Promise((resolve) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = () => resolve();
                request.onsuccess = () => { db = request.result; resolve(); };
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('products')) {
                        db.createObjectStore('products', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('bolusHistory')) {
                        db.createObjectStore('bolusHistory', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        async function loadDataFromDB() {
            if (!db) return;
            try {
                const products = await getFromDB('products');
                if (products.length > 0) AppState.products = products;
                const history = await getFromDB('bolusHistory');
                if (history.length > 0) AppState.bolusHistory = history;
            } catch (e) { }
        }

        function getFromDB(storeName) {
            return new Promise((resolve) => {
                if (!db) { resolve([]); return; }
                const tx = db.transaction([storeName], 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAll();
                req.onsuccess = () => resolve(req.result || []);
                req.onerror = () => resolve([]);
            });
        }

        function saveToDB(storeName, data) {
            return new Promise((resolve) => {
                if (!db) { resolve(); return; }
                const tx = db.transaction([storeName], 'readwrite');
                const store = tx.objectStore(storeName);
                store.put(data);
                tx.oncomplete = () => resolve();
            });
        }

        async function saveAllData() {
            if (!db) return;
            for (const p of AppState.products) await saveToDB('products', p);
            for (const h of AppState.bolusHistory) await saveToDB('bolusHistory', h);
        }

        function generateId() { return Date.now() + Math.random().toString(36).substr(2, 9); }

        function loadSampleData() {
            AppState.products = [
                { id: 1, name: 'Chleb pszenny', category: 'Piekarnicze', carbs: 49, unit: 'g', dateAdded: Date.now() },
                { id: 2, name: 'Banany', category: 'Owoce', carbs: 23.5, unit: 'g', dateAdded: Date.now() },
                { id: 3, name: 'Mleko 3.2%', category: 'Mleko', carbs: 4.8, unit: 'ml', dateAdded: Date.now() },
                { id: 4, name: 'Ry≈º bia≈Çy', category: 'Piekarnicze', carbs: 28, unit: 'g', dateAdded: Date.now() },
                { id: 5, name: 'Jab≈Çka', category: 'Owoce', carbs: 13.8, unit: 'g', dateAdded: Date.now() }
            ];
        }

        function initializeTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                });
            });
        }

        let pendingBolus = null;

        function initializeCalculator() {
            document.getElementById('calculate-bolus').addEventListener('click', calculateBolus);
            document.getElementById('add-product-btn').addEventListener('click', openProductModal);
            document.getElementById('confirm-bolus').addEventListener('click', confirmBolus);
            document.getElementById('cancel-bolus').addEventListener('click', () => {
                document.getElementById('bolus-result').style.display = 'none';
            });
            renderBolusHistory();
        }

        function calculateBolus() {
            const glucose = parseFloat(document.getElementById('glucose-level').value);
            const target = parseFloat(document.getElementById('target-glucose').value);
            const icr = parseFloat(document.getElementById('icr').value);
            const isf = parseFloat(document.getElementById('isf').value);
            const manual = parseFloat(document.getElementById('manual-carbs').value) || 0;

            if (!glucose) { alert('Podaj glikemiƒô!'); return; }

            let totalCarbs = manual;
            AppState.selectedProducts.forEach(item => {
                const p = AppState.products.find(x => x.id === item.productId);
                if (p) totalCarbs += (item.quantity / 100) * p.carbs;
            });

            const mealBolus = totalCarbs / icr;
            const corrBolus = (glucose - target) / isf;
            const totalBolus = Math.max(0, mealBolus + corrBolus);

            pendingBolus = {
                timestamp: new Date(),
                glucose: glucose,
                carbs: totalCarbs,
                totalBolus: totalBolus,
                mealBolus: mealBolus,
                correctionBolus: corrBolus
            };

            document.getElementById('meal-bolus').textContent = mealBolus.toFixed(2);
            document.getElementById('correction-bolus').textContent = corrBolus.toFixed(2);
            document.getElementById('total-bolus').textContent = totalBolus.toFixed(2);
            document.getElementById('total-carbs').textContent = totalCarbs.toFixed(1);
            document.getElementById('bolus-result').style.display = 'block';
        }

        async function confirmBolus() {
            if (!pendingBolus) return;
            pendingBolus.id = generateId();
            AppState.bolusHistory.unshift(pendingBolus);
            if (AppState.bolusHistory.length > 20) AppState.bolusHistory = AppState.bolusHistory.slice(0, 20);
            await saveToDB('bolusHistory', pendingBolus);
            renderBolusHistory();
            document.getElementById('bolus-result').style.display = 'none';
            document.getElementById('glucose-level').value = '';
            document.getElementById('manual-carbs').value = '0';
            AppState.selectedProducts = [];
            renderSelectedProducts();
            alert('‚úì Bolus zapisany!');
        }

        function openProductModal() {
            const list = AppState.products.map(p => `${p.name} (${p.carbs}g WW/100)`).join('\n');
            const selected = prompt('Dostƒôpne produkty:\n\n' + list + '\n\nWpisz nazwƒô produktu:');
            if (selected) {
                const product = AppState.products.find(p => p.name.toLowerCase().includes(selected.toLowerCase()));
                if (product) {
                    const qty = prompt(`Ilo≈õƒá ${product.name} (w ${product.unit}):`);
                    if (qty) {
                        AppState.selectedProducts.push({ productId: product.id, quantity: parseFloat(qty) });
                        renderSelectedProducts();
                    }
                }
            }
        }

        function renderSelectedProducts() {
            const container = document.getElementById('selected-products');
            if (AppState.selectedProducts.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 12px;">Brak wybranych produkt√≥w</div>';
                document.getElementById('products-carbs').value = '0 g';
                return;
            }
            let html = '';
            let totalCarbs = 0;
            AppState.selectedProducts.forEach((item, idx) => {
                const p = AppState.products.find(x => x.id === item.productId);
                if (!p) return;
                const carbs = (item.quantity / 100) * p.carbs;
                totalCarbs += carbs;
                html += `<div class="product-item"><div class="product-info">${p.name} (${item.quantity} ${p.unit})</div><div class="product-carbs">${carbs.toFixed(1)}g</div><button class="remove-btn" onclick="removeProduct(${idx})">Usu≈Ñ</button></div>`;
            });
            container.innerHTML = html;
            document.getElementById('products-carbs').value = totalCarbs.toFixed(1) + ' g';
        }

        function removeProduct(idx) {
            AppState.selectedProducts.splice(idx, 1);
            renderSelectedProducts();
        }

        function renderBolusHistory() {
            const container = document.getElementById('bolus-history');
            if (AppState.bolusHistory.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 12px;">Brak historii</div>';
                return;
            }
            container.innerHTML = AppState.bolusHistory.map(h => `<div style="background: #f8f9fb; border: 1px solid #ddd; border-radius: 6px; padding: 8px; margin-bottom: 6px;"><div><strong>${new Date(h.timestamp).toLocaleString('pl-PL')}</strong></div><div style="font-size: 11px;">Glikemia: ${h.glucose} mg/dl | WW: ${h.carbs.toFixed(1)}g | Bolus: ${h.totalBolus.toFixed(2)} j.i.</div></div>`).join('');
        }

        function initializeProducts() {
            document.getElementById('search-products').addEventListener('keyup', renderProductsList);
            document.getElementById('filter-category').addEventListener('change', renderProductsList);
            populateCategories();
            renderProductsList();
        }

        function populateCategories() {
            const select = document.getElementById('filter-category');
            AppState.categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                select.appendChild(opt);
            });
        }

        function renderProductsList() {
            const search = document.getElementById('search-products').value.toLowerCase();
            const category = document.getElementById('filter-category').value;
            let filtered = AppState.products;
            if (search) filtered = filtered.filter(p => p.name.toLowerCase().includes(search));
            if (category) filtered = filtered.filter(p => p.category === category);

            const container = document.getElementById('products-list');
            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 12px;">Nie znaleziono produkt√≥w</div>';
                return;
            }
            container.innerHTML = filtered.map(p => `<div class="product-item" style="cursor: pointer;" onclick="selectProductForCalculator(${p.id})"><div class="product-info">${p.name}<br/><small>${p.category} | ${p.carbs}g WW/100</small></div><div class="product-carbs">${p.carbs}g</div></div>`).join('');
        }

        function selectProductForCalculator(productId) {
            const p = AppState.products.find(x => x.id === productId);
            const qty = prompt(`Ilo≈õƒá ${p.name} (w ${p.unit}):`);
            if (qty) {
                AppState.selectedProducts.push({ productId: p.id, quantity: parseFloat(qty) });
                renderSelectedProducts();
            }
        }

        function addNewProduct() {
            const name = prompt('Nazwa produktu:');
            if (!name) return;
            const carbs = prompt('Wƒôglowodany na 100 j.m. (g):');
            if (!carbs) return;
            const category = prompt('Kategoria:', 'Inne');

            const product = {
                id: generateId(),
                name: name,
                category: category || 'Inne',
                carbs: parseFloat(carbs),
                unit: 'g',
                dateAdded: Date.now()
            };

            AppState.products.push(product);
            saveToDB('products', product);
            renderProductsList();
            alert('‚úì Produkt dodany!');
        }

        function initializeGuide() {
            document.querySelectorAll('.guide-header').forEach(header => {
                header.addEventListener('click', () => {
                    const section = header.closest('.guide-section');
                    section.classList.toggle('expanded');
                });
            });
        }
    </script>
</body>
</html>
